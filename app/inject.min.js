(function(){var e,i,n,t,s=!1,o=[],u=[],r=function(n){typeof n=="string"?console.log("PBULLY: "+n):console.log(n)},f=function(n,t){var i=o.indexOf(n);t?(i===-1&&o.push(n),s=!0):(i!==-1&&o.splice(i,1),o.length===0&&(s=!1))};e={enableKBShortcuts:localStorage.getItem("enableKBShortcuts")!="false",onlySelfSent:localStorage.getItem("onlySelfSent")=="true",notFiles:localStorage.getItem("notFiles")=="true",lockedPushes:localStorage.getItem("lockedPushes")||[],set:function(n,t){return e[n]=t,localStorage.setItem(n,t.toString()),t},get:function(n,t){return t=localStorage.getItem(n),e[n]=t,t}};n={list:[],checkedList:[],checkmark:chrome.runtime.getURL("img/checkmark.png"),initialize:function(n){var t=n.getElementsByClassName("profile-pic")[0],i,r;return n.getElementsByClassName,e.lockedPushes&&(r=e.lockedPushes.indexOf(n.id),i=n.classList.toggle("locked",r!=-1)),n.classList.contains("pushbully")||(n.classList.add("pushbully"),t&&(i?t.setAttribute("title","This push is locked."):t.setAttribute("title","Click to mark this push for deletion."))),t},getCloseButton:function(n){return n.getElementsByClassName("push-close")[0]},refresh:function(i,r,e){var o,c,s,l,h;e=e&&u.length;f("refresh",!0);try{if(n.list=document.getElementsByClassName("push"),!r){for(n.checkedList=document.getElementsByClassName("pushbully checked"),s=0,l=n.list.length;s<l;s++)o=n.list[s],n.initialize(o),e&&(c=u.indexOf(o.id)!==-1,c!==o.classList.contains("checked")&&n.check(o,c));if(e)for(h=u.length-1;h>=0;--s)document.getElementById(u[h])||u.splice(h,1)}i&&n.deselectAll();t.update()}catch(a){console.log(a)}finally{f("refresh",!1)}},scrollIntoView:function(n){var u=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,f=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,i=0,r=0,t;if(document.layers)i=n.y,r=n.height;else{for(t=n;t&&t.tagName!=="BODY";t=t.offsetParent)i+=t.offsetTop;r=n.offsetHeight}u+f<i+r?n.scrollIntoView(!1):i<u&&n.scrollIntoView(!0)},highlight:function(t){for(var r=document.getElementsByClassName("highlit"),u=t?t.classList.contains("highlit"):!0,i=0,f=r.length;i<f;i++)r[i].classList.remove("highlit");u||(t.classList.add("highlit"),n.scrollIntoView(t))},check:function(t,i){var r,o,f,e;i!=t.classList.contains("checked")&&(r=n.initialize(t),e=u.indexOf(t.id),i?(o="Click to save this push from certain doom.",f=r.getAttribute("src"),r.setAttribute("src",n.checkmark),r.setAttribute("data-prevsrc",f),e!==-1&&u.push(t)):(o="Click to mark this push for destruction.",f=r.getAttribute("data-prevsrc"),f&&(r.setAttribute("src",f),r.setAttribute("data-prevsrc","")),e!==-1&&u.splice(e,1)),t.classList.toggle("checked",i),r.setAttribute("title",o))},doSelect:function(t){for(var i=n.list.length-1;i>=0;i--)n.check(n.list[i],t,!0);n.refresh()},deselectAll:function(){n.doSelect(!1)},pDelete:function(t){var u,i,e,o,s;(n.refresh(),f("delete",!0),u=t?n.list:n.checkedList,i=u.length,i>5&&!confirm("Are you sure you would like to delete "+(t?"all %+":"these %").replace("%",i)+" pushes?\n\nThis cannot be canceled nor undone."))||(o=0,s=function(){n.refresh();f("delete",!0);try{if(u=t?n.list:n.checkedList,i=u.length,i>0){for(e=i-1;e>=0;e--)n.getCloseButton(u[e]).click(),o++;if(t){window.setTimeout(s,500);return}}r("Deletion complete. Deleted "+o+" pushes.");window.setTimeout(function(){n.refresh()},500)}catch(h){}finally{f("delete",!1)}},s())},deleteSelected:function(){n.pDelete(!1)}};t={selectAll:null,deleteSelected:null,deleteAll:null,inject:function(){var u,f,e;if(r("Injecting buttons..."),i.pushListDiv){if(document.getElementById("pushbully-button-box"))return r("buttons.inject: Buttons div already exists."),!0}else return r("buttons.inject: main.pushListDiv (push_cards) not found. Stopping inject..."),!1;return r("buttons.inject: Injecting buttons..."),u=document.createElement("div"),u.id="pushbully-button-box",r("buttonsDiv:"),r(u),f=document.createElement("button"),f.className="btn pushbully-button",t.selectAll=f.cloneNode(),t.selectAll.innerText="Select All",t.selectAll.id="select-all-button",u.appendChild(t.selectAll),t.deleteSelected=f.cloneNode(),t.deleteSelected.innerText="Delete Selected",t.deleteSelected.id="delete-selected-button",t.deleteSelected.title="Click to delete all selected pushes.",t.deleteSelected.onclick=n.deleteSelected,u.appendChild(t.deleteSelected),e=f.cloneNode(),e.innerText="Refresh Boxes",e.id="refresh-boxes-button",e.title="Sometimes pushes won't have checkboxes on them. Click this to fix that.",e.onclick=n.refresh,u.appendChild(e),t.deleteAll=f.cloneNode(),t.deleteAll.innerText="Delete All",t.deleteAll.id="delete-all-button",t.deleteAll.title="Click to delete all of your pushes, starting from the current page on.",t.deleteAll.onclick=n.pDelete,u.appendChild(t.deleteAll),i.pushListDiv.insertAdjacentElement("beforeBegin",u),r("Button box and buttons injected."),!0},update:function(){n.list.length&&n.checkedList.length?(t.deleteSelected.innerText="Delete Selected ("+n.checkedList.length+")",t.selectAll.innerText="Deselect All",t.selectAll.title="Click to deselect all selected pushes.",t.selectAll.onclick=n.deselectAll):(t.deleteSelected.innerText="Delete Selected",t.selectAll.innerText="Select All"+(n.list.length?" ("+n.list.length+")":""),t.selectAll.title="Click to select all pushes on the current page.",t.selectAll.onclick=n.doSelect);t.selectAll.disabled=t.deleteAll.disabled=!n.list.length;t.deleteSelected.disabled=!n.checkedList.length}};i={pushListDiv:null,MyObserver:null,observer:null,pushListClick:function(t){for(var u,i=u=t.toElement,r=0;r<=3;){if((i=i.parentElement).classList.contains("push")){r=null;break}r++}r===null&&(u.classList.contains("profile-pic")?(console.log("profile pic clicked"),n.check(i,!i.classList.contains("checked")),n.refresh()):u.classList.contains("push-close")?console.log("close button clicked"):console.log("somewhere else clicked"))},doReset:function(){f("doreset",!0);try{if((i.pushListDiv=document.getElementsByClassName("push_cards")[0],!i.pushListDiv)||(i.pushListDiv.onclick=i.pushListClick,!t.inject()))return!1;n.refresh();try{i.observer&&i.observer.stop();i.MyObserver=window.MutationObserver||window.WebKitMutationObserver||new MutationObserver;var u;i.observer=new i.MyObserver(function(){if(s){alert("mutation observer fired, but inProg = true");return}u&&window.clearTimeout(u);alert("mutation observer fired - about to refresh in 200ms");u=window.setTimeout(function(){n.refresh(!1,!1,!0)},400)});i.observer.observe(i.pushListDiv,{childList:!0,subtree:!0});r("Initialize: Attached mutation observer to listen for new pushes.")}catch(e){r("Initialize: Could not attach mutation observer due to error:");r(e)}return!0}catch(o){return!1}finally{f("doreset",!1)}},reset:function(n){if(n)window.setTimeout(i.doReset,n);else return i.doReset()},initialize:function(){if(!i.reset())return r("Did not reset. Canceling"),!1;var n=window.history,t=n.pushState;n.pushState=function(u){if(r("PushState: wHist.pushState state changed. Resetting..."),n.onpushstate)n.onpushstate({state:u});return i.reset(500),t.apply(n,arguments)};window.onhashchange=window.onpopstate=window.onpushstate=function(){i.reset(500)};r("Initialize: Attached pop state listener to listen for page change.")}};i.initialize()})();
/*
//# sourceMappingURL=inject.min.js.map
*/