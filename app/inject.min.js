"use strict";var options,main,pushes,buttons,inProg=!1,keyList=[],checkedPushIDs=[],log=function(n){typeof n=="string"?console.log("PBULLY: "+n):console.log(n)},setProcessing=function(n,t){var i=keyList.indexOf(n);t?(i===-1&&keyList.push(n),inProg=!0):(i!==-1&&keyList.splice(i,1),keyList.length===0&&(inProg=!1))};options={enableKBShortcuts:localStorage.getItem("enableKBShortcuts")!="false",onlySelfSent:localStorage.getItem("onlySelfSent")=="true",notFiles:localStorage.getItem("notFiles")=="true",lockedPushes:JSON.parse(localStorage.getItem("lockedPushes")||"[]"),get:function(n){return JSON.parse(localStorage.getItem(n)||null)},set:function(n,t){t&&n&&options[n]&&(options[n]=t,localStorage.setItem(n,JSON.stringify(t)))}};pushes={list:[],checkedList:[],checkmark:chrome.runtime.getURL("img/checkmark.png"),initialize:function(n){var t=n.getElementsByClassName("profile-pic")[0],i,r;return options.lockedPushes&&(r=options.lockedPushes.indexOf(n.id),i=n.classList.toggle("locked",r!=-1)),n.classList.contains("pushbully")||(n.classList.add("pushbully"),t&&(i?t.setAttribute("title","This push is locked."):t.setAttribute("title","Click to mark this push for deletion."))),t},getCloseButton:function(n){return n.getElementsByClassName("push-close")[0]},toggleLock:function(n,t){var r=n.classList.toggle("locked",t),i=options.lockedPushes.indexOf(n.id);i!==-1&&options.lockedPushes.splice(i,1);r&&options.lockedPushes.push(n.id)},refresh:function(n,t,i){var r,e,u,o,f;i=i&&checkedPushIDs.length;setProcessing("refresh",!0);try{if(pushes.list=document.getElementsByClassName("push"),!t){for(pushes.checkedList=document.getElementsByClassName("pushbully checked"),u=0,o=pushes.list.length;u<o;u++)r=pushes.list[u],pushes.initialize(r),i&&(e=checkedPushIDs.indexOf(r.id)!==-1,e!==r.classList.contains("checked")&&pushes.check(r,e));if(i)for(f=checkedPushIDs.length-1;f>=0;--u)document.getElementById(checkedPushIDs[f])||checkedPushIDs.splice(f,1)}n&&pushes.deselectAll();buttons.update()}catch(s){console.log(s)}finally{setProcessing("refresh",!1)}},scrollIntoView:function(n){var u=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,f=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,i=0,r=0,t;if(document.layers)i=n.y,r=n.height;else{for(t=n;t&&t.tagName!=="BODY";t=t.offsetParent)i+=t.offsetTop;r=n.offsetHeight}u+f<i+r?n.scrollIntoView(!1):i<u&&n.scrollIntoView(!0)},highlight:function(n){for(var i=document.getElementsByClassName("highlit"),r=n?n.classList.contains("highlit"):!0,t=0,u=i.length;t<u;t++)i[t].classList.remove("highlit");r||(n.classList.add("highlit"),pushes.scrollIntoView(n))},check:function(n,t){var i,f,r,u;t==n.classList.contains("checked")||n.classList.contains("locked")||(i=pushes.initialize(n),u=checkedPushIDs.indexOf(n.id),t?(f="Click to save this push from certain doom.",r=i.getAttribute("src"),i.setAttribute("src",pushes.checkmark),i.setAttribute("data-prevsrc",r),u!==-1&&checkedPushIDs.push(n)):(f="Click to mark this push for destruction.",r=i.getAttribute("data-prevsrc"),r&&(i.setAttribute("src",r),i.setAttribute("data-prevsrc","")),u!==-1&&checkedPushIDs.splice(u,1)),n.classList.toggle("checked",t),i.setAttribute("title",f))},doSelect:function(n){for(var t=pushes.list.length-1;t>=0;t--)pushes.check(pushes.list[t],n,!0);pushes.refresh()},deselectAll:function(){pushes.doSelect(!1)},pDelete:function(n){var i,t,r,u,f;(pushes.refresh(),setProcessing("delete",!0),i=n?pushes.list:pushes.checkedList,t=i.length,t>5&&!confirm("Are you sure you would like to delete "+(n?"all %+":"these %").replace("%",t)+" pushes?\n\nThis cannot be canceled nor undone."))||(u=0,f=function(){pushes.refresh();setProcessing("delete",!0);try{if(i=n?pushes.list:pushes.checkedList,t=i.length,t>0){for(r=t-1;r>=0;r--)pushes.getCloseButton(i[r]).click(),u++;if(n){window.setTimeout(f,500);return}}log("Deletion complete. Deleted "+u+" pushes.");window.setTimeout(function(){pushes.refresh()},500)}catch(e){}finally{setProcessing("delete",!1)}},f())},deleteSelected:function(){pushes.pDelete(!1)}};buttons={selectAll:null,deleteSelected:null,deleteAll:null,inject:function(){var n,t,i;if(log("Injecting buttons..."),main.pushListDiv){if(document.getElementById("pushbully-box"))return log("buttons.inject: Buttons div already exists."),!0}else return log("buttons.inject: main.pushListDiv (push_cards) not found. Stopping inject..."),!1;return log("buttons.inject: Injecting buttons..."),n=document.createElement("div"),n.id="pushbully-box",n.className="roundbottom",log("buttonsDiv:"),log(n),t=document.createElement("button"),t.className="btn pushbully-button",buttons.selectAll=t.cloneNode(),buttons.selectAll.innerText="Select All",buttons.selectAll.id="select-all-button",n.appendChild(buttons.selectAll),buttons.deleteSelected=t.cloneNode(),buttons.deleteSelected.innerText="Delete Selected",buttons.deleteSelected.id="delete-selected-button",buttons.deleteSelected.title="Click to delete all selected pushes.",buttons.deleteSelected.onclick=pushes.deleteSelected,n.appendChild(buttons.deleteSelected),i=t.cloneNode(),i.innerText="Refresh Boxes",i.id="refresh-boxes-button",i.title="Sometimes pushes won't have checkboxes on them. Click this to fix that.",i.onclick=pushes.refresh,n.appendChild(i),buttons.deleteAll=t.cloneNode(),buttons.deleteAll.innerText="Delete All",buttons.deleteAll.id="delete-all-button",buttons.deleteAll.title="Click to delete all of your pushes, starting from the current page on.",buttons.deleteAll.onclick=pushes.pDelete,n.appendChild(buttons.deleteAll),main.pushListDiv.insertAdjacentElement("beforeBegin",n),log("Button box and buttons injected."),!0},update:function(){pushes.list.length&&pushes.checkedList.length?(buttons.deleteSelected.innerText="Delete Selected ("+pushes.checkedList.length+")",buttons.selectAll.innerText="Deselect All",buttons.selectAll.title="Click to deselect all selected pushes.",buttons.selectAll.onclick=pushes.deselectAll):(buttons.deleteSelected.innerText="Delete Selected",buttons.selectAll.innerText="Select All"+(pushes.list.length?" ("+pushes.list.length+")":""),buttons.selectAll.title="Click to select all pushes on the current page.",buttons.selectAll.onclick=pushes.doSelect);buttons.selectAll.disabled=buttons.deleteAll.disabled=!pushes.list.length;buttons.deleteSelected.disabled=!pushes.checkedList.length}};main={pushListDiv:null,MyObserver:null,observer:null,pushListClick:function(n){for(var r,t=r=n.toElement,i=0;i<=3;){if((t=t.parentElement).classList.contains("push")){i=null;break}i++}i===null&&(r.classList.contains("profile-pic")?(console.log("profile pic clicked"),pushes.check(t,!t.classList.contains("checked")),pushes.refresh()):r.classList.contains("push-close")?console.log("close button clicked"):console.log("somewhere else clicked"))},doReset:function(){setProcessing("doreset",!0);try{if((main.pushListDiv=document.getElementsByClassName("push_cards")[0],!main.pushListDiv)||(main.pushListDiv.onclick=main.pushListClick,!buttons.inject()))return!1;pushes.refresh();try{main.observer&&main.observer.stop();main.MyObserver=window.MutationObserver||window.WebKitMutationObserver||new MutationObserver;var n;main.observer=new main.MyObserver(function(){inProg||(n&&window.clearTimeout(n),n=window.setTimeout(function(){pushes.refresh(!1,!1,!0)},400))});main.observer.observe(main.pushListDiv,{childList:!0,subtree:!0});log("Initialize: Attached mutation observer to listen for new pushes.")}catch(t){log("Initialize: Could not attach mutation observer due to error:");log(t)}return!0}catch(i){return!1}finally{setProcessing("doreset",!1)}},reset:function(n){if(n)window.setTimeout(main.doReset,n);else return main.doReset()},initialize:function(){if(!main.reset())return log("Did not reset. Canceling"),!1;window.onkeydown=main.handleKeyDown}};main.initialize();
/*
//# sourceMappingURL=inject.min.js.map
*/